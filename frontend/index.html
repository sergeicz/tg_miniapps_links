<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–ü–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∏–µ —Å—Å—ã–ª–∫–∏</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

:root {
  --primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  --secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
  --success: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
  --glass-bg: rgba(255, 255, 255, 0.1);
  --glass-border: rgba(255, 255, 255, 0.18);
  --text-primary: #ffffff;
  --text-secondary: rgba(255, 255, 255, 0.7);
  --shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
}

@keyframes gradient {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}

@keyframes shimmer {
  0% { background-position: -1000px 0; }
  100% { background-position: 1000px 0; }
}

body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
  background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
  background-size: 400% 400%;
  animation: gradient 15s ease infinite;
  color: var(--text-primary);
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 20px;
  overflow-x: hidden;
}

.container {
  max-width: 600px;
  width: 100%;
  animation: fadeInUp 0.8s ease-out;
}

/* Avatar Section */
.avatar-container {
  text-align: center;
  margin-bottom: 30px;
  animation: float 3s ease-in-out infinite;
}

.avatar-container img {
  width: 120px;
  height: 120px;
  border-radius: 50%;
  border: 4px solid var(--glass-border);
  background: var(--glass-bg);
  backdrop-filter: blur(10px);
  box-shadow: var(--shadow), 0 0 40px rgba(255, 255, 255, 0.2);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.avatar-container img:hover {
  transform: scale(1.1) rotate(5deg);
  box-shadow: var(--shadow), 0 0 60px rgba(255, 255, 255, 0.4);
}

/* Title */
h1 {
  text-align: center;
  font-size: 2.5rem;
  font-weight: 800;
  margin-bottom: 40px;
  background: linear-gradient(135deg, #fff 0%, rgba(255,255,255,0.7) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  text-shadow: 0 4px 20px rgba(255, 255, 255, 0.3);
  animation: pulse 2s ease-in-out infinite;
}

/* Glassmorphism Card */
.glass-card {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border-radius: 24px;
  border: 1px solid var(--glass-border);
  padding: 25px;
  margin-bottom: 20px;
  box-shadow: var(--shadow);
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  animation: fadeInUp 0.6s ease-out backwards;
}

.glass-card:nth-child(2) { animation-delay: 0.1s; }
.glass-card:nth-child(3) { animation-delay: 0.2s; }
.glass-card:nth-child(4) { animation-delay: 0.3s; }

.glass-card:hover {
  transform: translateY(-8px) scale(1.02);
  box-shadow: 0 12px 48px 0 rgba(31, 38, 135, 0.5);
  border-color: rgba(255, 255, 255, 0.3);
}

.glass-card h2 {
  font-size: 1.5rem;
  font-weight: 700;
  margin-bottom: 20px;
  color: var(--text-primary);
  display: flex;
  align-items: center;
  gap: 10px;
}

.glass-card h2::before {
  content: '';
  display: inline-block;
  width: 4px;
  height: 24px;
  background: var(--primary);
  border-radius: 4px;
}

/* Modern Button */
.modern-btn {
  display: block;
  width: 100%;
  padding: 16px 24px;
  margin: 12px 0;
  text-align: center;
  color: var(--text-primary);
  text-decoration: none;
  font-size: 1rem;
  font-weight: 600;
  border-radius: 16px;
  background: var(--glass-bg);
  backdrop-filter: blur(10px);
  border: 1px solid var(--glass-border);
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  cursor: pointer;
}

.modern-btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
  transition: left 0.5s;
}

.modern-btn:hover::before {
  left: 100%;
}

.modern-btn:hover {
  transform: translateY(-4px) scale(1.02);
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
  border-color: rgba(255, 255, 255, 0.4);
  background: rgba(255, 255, 255, 0.15);
}

.modern-btn:active {
  transform: translateY(-2px) scale(0.98);
}

/* Gradient Button */
.gradient-btn {
  background: var(--primary);
  border: none;
  color: white;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 1px;
  position: relative;
  overflow: hidden;
}

.gradient-btn::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 0;
  height: 0;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.3);
  transform: translate(-50%, -50%);
  transition: width 0.6s, height 0.6s;
}

.gradient-btn:hover::after {
  width: 300px;
  height: 300px;
}

.gradient-btn:hover {
  box-shadow: 0 12px 32px rgba(102, 126, 234, 0.6);
}

/* Admin Button */
#adminBtn {
  display: none;
  margin: 30px 0;
  background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
  border: none;
  box-shadow: 0 8px 24px rgba(17, 153, 142, 0.4);
}

#adminBtn:hover {
  box-shadow: 0 12px 32px rgba(17, 153, 142, 0.6);
}

/* Categories */
#categories {
  display: grid;
  gap: 20px;
}

/* Loading State */
.loading {
  text-align: center;
  padding: 40px 20px;
  font-size: 1.2rem;
  color: var(--text-secondary);
}

.loading::after {
  content: '...';
  animation: shimmer 1.5s infinite;
}

/* Admin Panel */
#adminPanel {
  display: none;
  animation: fadeInUp 0.5s ease-out;
}

#adminPanel h2 {
  font-size: 1.8rem;
  margin: 30px 0 20px;
  background: var(--success);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

/* Stats Cards */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 15px;
  margin-bottom: 30px;
}

.stat-card {
  background: var(--glass-bg);
  backdrop-filter: blur(10px);
  border-radius: 16px;
  padding: 20px;
  text-align: center;
  border: 1px solid var(--glass-border);
  transition: all 0.3s ease;
}

.stat-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
}

.stat-card .number {
  font-size: 2rem;
  font-weight: 800;
  background: var(--primary);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.stat-card .label {
  font-size: 0.9rem;
  color: var(--text-secondary);
  margin-top: 5px;
}

/* Table */
.user-table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  background: var(--glass-bg);
  backdrop-filter: blur(10px);
  border-radius: 16px;
  overflow: hidden;
  border: 1px solid var(--glass-border);
}

.user-table th,
.user-table td {
  padding: 15px;
  text-align: left;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.user-table th {
  background: rgba(255, 255, 255, 0.05);
  font-weight: 700;
  text-transform: uppercase;
  font-size: 0.85rem;
  letter-spacing: 1px;
}

.user-table tr:hover {
  background: rgba(255, 255, 255, 0.05);
}

/* Form */
#pushForm {
  display: grid;
  gap: 15px;
}

#pushForm input,
#pushForm textarea {
  width: 100%;
  padding: 16px;
  border-radius: 12px;
  border: 1px solid var(--glass-border);
  background: var(--glass-bg);
  backdrop-filter: blur(10px);
  color: var(--text-primary);
  font-size: 1rem;
  font-family: inherit;
  transition: all 0.3s ease;
}

#pushForm input:focus,
#pushForm textarea:focus {
  outline: none;
  border-color: rgba(255, 255, 255, 0.4);
  background: rgba(255, 255, 255, 0.15);
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
}

#pushForm input::placeholder,
#pushForm textarea::placeholder {
  color: var(--text-secondary);
}

#pushForm button {
  padding: 18px;
  border: none;
  border-radius: 12px;
  background: var(--secondary);
  color: white;
  font-size: 1.1rem;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.3s ease;
  text-transform: uppercase;
  letter-spacing: 1px;
}

#pushForm button:hover {
  transform: translateY(-2px);
  box-shadow: 0 12px 32px rgba(245, 87, 108, 0.6);
}

#pushForm button:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  transform: none;
}

/* Responsive */
@media (max-width: 768px) {
  body {
    padding: 15px;
  }

  h1 {
    font-size: 2rem;
  }

  .glass-card {
    padding: 20px;
  }

  .glass-card h2 {
    font-size: 1.3rem;
  }

  .modern-btn {
    padding: 14px 20px;
    font-size: 0.95rem;
  }

  .avatar-container img {
    width: 100px;
    height: 100px;
  }
}

@media (max-width: 480px) {
  h1 {
    font-size: 1.8rem;
  }

  .glass-card {
    padding: 18px;
  }

  .modern-btn {
    padding: 12px 16px;
    font-size: 0.9rem;
  }
}

/* Smooth Scrolling */
html {
  scroll-behavior: smooth;
}

/* Selection */
::selection {
  background: rgba(255, 255, 255, 0.3);
  color: white;
}
</style>
</head>
<body>
<div class="container">
  <div class="avatar-container">
    <img src="img/img.png?v=2" alt="–ê–≤–∞—Ç–∞—Ä">
  </div>
  
  <h1>‚ú® –ü–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∏–µ —Å—Å—ã–ª–∫–∏</h1>
  
  <div id="categories"></div>
  
  <button id="adminBtn" class="modern-btn gradient-btn">‚öôÔ∏è –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</button>
  
  <div id="adminPanel">
    <div class="glass-card">
      <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
      <div id="stats" class="stats-grid"></div>
    </div>
    
    <div class="glass-card">
      <h2>üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h2>
      <table class="user-table" id="userTable">
        <thead>
          <tr>
            <th>Username</th>
            <th>Telegram ID</th>
            <th>–°—Ç–∞—Ç—É—Å</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    
    <div class="glass-card">
      <h2>üì¢ –†–∞—Å—Å—ã–ª–∫–∞</h2>
      <form id="pushForm">
        <input type="text" id="pushTitle" placeholder="üìù –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏—è">
        <textarea id="pushMessage" rows="4" placeholder="üí¨ –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è"></textarea>
        <input type="text" id="pushLink" placeholder="üîó –°—Å—ã–ª–∫–∞ –¥–ª—è –∫–Ω–æ–ø–∫–∏">
        <button type="submit">üöÄ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É</button>
      </form>
    </div>
  </div>
</div>
<script>
// –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è API
const CONFIG = {
  API_URL: 'https://telegram-miniapp-api.worknotdead.workers.dev',  // –ü–†–û–î–ê–ö–®–ï–ù
};

const tg = Telegram.WebApp;

// –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram
let user = tg.initDataUnsafe.user || {
  id: 0,
  username: 'guest',
  first_name: 'Guest',
  language_code: 'ru'
};

console.log('üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:', user);

// –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ Telegram WebApp
if (tg.expand) tg.expand();
if (tg.ready) tg.ready();

// –£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö fetch –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
async function safeFetch(url, options = {}) {
  try {
    const response = await fetch(url, {
      ...options,
      headers: {
        'Content-Type': 'application/json',
        ...options.headers,
      },
    });

    if (!response.ok) {
      const error = await response.json().catch(() => ({ error: 'Unknown error' }));
      throw new Error(error.error || `HTTP ${response.status}`);
    }

    return await response.json();
  } catch (error) {
    console.error('Fetch error:', error);
    showError(error.message || '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ.');
    throw error;
  }
}

// –ü–æ–∫–∞–∑ –æ—à–∏–±–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
function showError(message) {
  console.error('‚ùå –û—à–∏–±–∫–∞:', message);
  if (tg.showAlert) {
    tg.showAlert(message);
  } else {
    alert(message);
  }
}

// –ü–æ–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è
function showSuccess(message) {
  console.log('‚úÖ –£—Å–ø–µ—Ö:', message);
  if (tg.showAlert) {
    tg.showAlert(message);
  } else {
    alert(message);
  }
}

// –ü–æ–∫–∞–∑ –∑–∞–≥—Ä—É–∑–∫–∏
function showLoading(elementId) {
  const element = document.getElementById(elementId);
  if (element) {
    element.innerHTML = '<div class="loading">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞</div>';
  }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
async function initApp() {
  try {
    console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
    console.log('üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:', user);
    
    // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    await safeFetch(`${CONFIG.API_URL}/api/user`, {
      method: 'POST',
      body: JSON.stringify(user),
    }).catch(err => console.warn('User registration failed:', err));

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
    console.log('üîê –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞...');
    await checkAdmin();

    // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤
    console.log('üì¶ –ó–∞–≥—Ä—É–∑–∫–∞ –ø–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∏—Ö —Å—Å—ã–ª–æ–∫...');
    await loadPartners();
    
    console.log('‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!');

  } catch (error) {
    console.error('‚ùå Init error:', error);
    showError('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è');
  }
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
async function checkAdmin() {
  try {
    const data = await safeFetch(`${CONFIG.API_URL}/api/me`, {
      method: 'POST',
      body: JSON.stringify(user),
    });

    if (data.is_admin) {
      const btn = document.getElementById('adminBtn');
      btn.style.display = 'block';
      btn.onclick = toggleAdminPanel;
    }
  } catch (error) {
    console.error('Admin check failed:', error);
  }
}

// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø–∞–Ω–µ–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
function toggleAdminPanel() {
  const panel = document.getElementById('adminPanel');
  
  // –ü–æ–ª—É—á–∞–µ–º computed style, —Ç–∞–∫ –∫–∞–∫ inline style –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º
  const currentDisplay = window.getComputedStyle(panel).display;
  const isVisible = currentDisplay !== 'none';
  
  console.log('üîÑ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏. –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:', isVisible ? '–≤–∏–¥–Ω–∞' : '—Å–∫—Ä—ã—Ç–∞');
  
  if (isVisible) {
    panel.style.display = 'none';
    console.log('‚ùå –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å —Å–∫—Ä—ã—Ç–∞');
  } else {
    panel.style.display = 'block';
    console.log('‚úÖ –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –ø–æ–∫–∞–∑–∞–Ω–∞');
    loadAdminData();
  }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤
async function loadPartners() {
  const container = document.getElementById('categories');
  showLoading('categories');

  try {
    const partners = await safeFetch(`${CONFIG.API_URL}/api/partners`);

    if (!partners || partners.length === 0) {
      container.innerHTML = '<p style="text-align:center;">–ü–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∏–µ —Å—Å—ã–ª–∫–∏ –ø–æ–∫–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</p>';
      return;
    }

    // –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
    const categories = {};
    partners.forEach(p => {
      if (!categories[p.category]) categories[p.category] = [];
      categories[p.category].push(p);
    });

    // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
    container.innerHTML = '';
    for (const [catName, links] of Object.entries(categories)) {
      const div = document.createElement('div');
      div.className = 'glass-card';

      const h = document.createElement('h2');
      h.textContent = catName;
      div.appendChild(h);

      links.forEach(link => {
        const a = document.createElement('a');
        a.className = 'modern-btn';
        a.href = link.url;
        a.target = '_blank';
        a.textContent = link.title;
        a.onclick = (e) => handleLinkClick(e, link);
        div.appendChild(a);
      });

      container.appendChild(div);
    }
  } catch (error) {
    container.innerHTML = '<p style="text-align:center;color:red;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤</p>';
  }
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –ø–æ —Å—Å—ã–ª–∫–µ
async function handleLinkClick(event, link) {
  try {
    // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–ª–∏–∫–∞ (–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ–º –ø–µ—Ä–µ—Ö–æ–¥)
    safeFetch(`${CONFIG.API_URL}/api/click`, {
      method: 'POST',
      body: JSON.stringify({
        telegram_id: user.id,
        url: link.url,
      }),
    }).catch(err => console.warn('Click tracking failed:', err));

    // –í–∏–±—Ä–∞—Ü–∏—è –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
    if (tg.HapticFeedback) {
      tg.HapticFeedback.impactOccurred('light');
    }
  } catch (error) {
    console.error('Link click handler error:', error);
  }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
async function loadAdminData() {
  const statsDiv = document.getElementById('stats');
  const table = document.getElementById('userTable');

  showLoading('stats');
  table.innerHTML = '<tr><th>Username</th><th>Telegram ID</th><th>–ü–æ–¥–ø–∏—Å–∞–Ω</th></tr>';

  try {
    const users = await safeFetch(`${CONFIG.API_URL}/api/subscribers`);

    // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    const subscribed = users.filter(u => u.subscribed).length;
    const unsubscribed = users.length - subscribed;
    statsDiv.innerHTML = `
      <div class="stat-card">
        <div class="number">${users.length}</div>
        <div class="label">–í—Å–µ–≥–æ</div>
      </div>
      <div class="stat-card">
        <div class="number">${subscribed}</div>
        <div class="label">–ü–æ–¥–ø–∏—Å–∞–Ω—ã</div>
      </div>
      <div class="stat-card">
        <div class="number">${unsubscribed}</div>
        <div class="label">–û—Ç–ø–∏—Å–∞–Ω—ã</div>
      </div>
    `;

    // –¢–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    const tbody = table.querySelector('tbody');
    tbody.innerHTML = '';
    users.forEach(u => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${u.username || 'N/A'}</td>
        <td>${u.telegram_id}</td>
        <td>${u.subscribed ? '‚úÖ' : '‚ùå'}</td>
      `;
      tbody.appendChild(tr);
    });
  } catch (error) {
    statsDiv.innerHTML = '<div style="color:#ff6b6b;text-align:center;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</div>';
  }
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã —Ä–∞—Å—Å—ã–ª–∫–∏
document.getElementById('pushForm').onsubmit = async (e) => {
  e.preventDefault();

  const title = document.getElementById('pushTitle').value.trim();
  const msg = document.getElementById('pushMessage').value.trim();
  const link = document.getElementById('pushLink').value.trim();

  // –í–∞–ª–∏–¥–∞—Ü–∏—è
  if (!title || !msg || !link) {
    showError('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
    return;
  }

  if (!link.startsWith('http://') && !link.startsWith('https://')) {
    showError('–°—Å—ã–ª–∫–∞ –¥–æ–ª–∂–Ω–∞ –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å http:// –∏–ª–∏ https://');
    return;
  }

  const submitBtn = e.target.querySelector('button');
  const originalText = submitBtn.textContent;
  submitBtn.disabled = true;
  submitBtn.textContent = '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...';

  try {
    const result = await safeFetch(`${CONFIG.API_URL}/api/push`, {
      method: 'POST',
      body: JSON.stringify({ title, msg, link }),
    });

    showSuccess(`‚úÖ –ü—É—à –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω! (${result.sent || 0}/${result.total || 0} —É—Å–ø–µ—à–Ω–æ)`);

    // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
    document.getElementById('pushTitle').value = '';
    document.getElementById('pushMessage').value = '';
    document.getElementById('pushLink').value = '';

  } catch (error) {
    // –û—à–∏–±–∫–∞ —É–∂–µ –ø–æ–∫–∞–∑–∞–Ω–∞ –≤ safeFetch
  } finally {
    submitBtn.disabled = false;
    submitBtn.textContent = originalText;
  }
};

// –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
window.addEventListener('DOMContentLoaded', initApp);

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
window.addEventListener('error', (event) => {
  console.error('Global error:', event.error);
});

window.addEventListener('unhandledrejection', (event) => {
  console.error('Unhandled promise rejection:', event.reason);
});
</script>
</body>
</html>
